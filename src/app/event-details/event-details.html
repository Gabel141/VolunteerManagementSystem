<div class="event-details-viewport container py-4">
    <!-- Back link -->
    <div class="row mb-3">
        <div class="col-12">
            <a routerLink="/events" class="btn btn-sm btn-outline-secondary">‚Üê Back to Events</a>
        </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading()" class="text-center py-4">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Error state -->
    <div *ngIf="!loading() && error()" class="alert alert-danger" role="alert">
        {{ error() }}
    </div>

    <!-- Event detail -->
    <div *ngIf="!loading() && event() as evt" class="row">
        <!-- Left: Event Info Section -->
        <div class="col-12 col-lg-8 mb-4">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="d-flex gap-3 align-items-center flex-grow-1">
                            <div class="creator-avatar me-2">
                                <img *ngIf="creatorProfile?.profilePicture" [src]="creatorProfile?.profilePicture" alt="{{ creatorProfile?.displayName }}" class="rounded-circle" style="width:56px;height:56px;object-fit:cover;" />
                                <div *ngIf="!creatorProfile?.profilePicture" class="avatar-fallback rounded-circle" style="width:56px;height:56px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--sunlit-clay),var(--copperwood));color:var(--cornsilk);font-weight:700;">{{ (creatorProfile?.displayName||evt.creator||'?').charAt(0) }}</div>
                            </div>
                            <div class="flex-grow-1">
                                <h2 class="card-title text-primary mb-2">{{ evt.title }}</h2>
                                <p class="text-muted mb-0">
                                    Created by <strong>{{ creatorProfile?.displayName || evt.creator }}</strong>
                                    <span *ngIf="evt.creatorEmail" class="text-muted">({{ evt.creatorEmail }})</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="event-meta mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-2">
                                    <strong>üìÖ Date:</strong> {{ evt.date }}
                                </p>
                                <p class="mb-2">
                                    <strong>üïí Time:</strong> {{ evt.time }}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-2">
                                    <strong>üìç Location:</strong> {{ evt.location }}
                                </p>
                                <p *ngIf="evt.workType" class="mb-2">
                                    <strong>üîß Work Type:</strong> {{ evt.workType }}
                                </p>
                                <!-- Map link removed -->
                                <p class="mb-2">
                                    <strong>üë• Participants:</strong> {{ getParticipantCountText() }}
                                    <span *ngIf="isEventFull()" class="badge bg-danger ms-2">Full</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Map preview removed: map and embedded Google Maps have been deprecated in the UI -->

                    <div class="event-description">
                        <h5>Description</h5>
                        <p>{{ evt.description }}</p>
                    </div>

                    <!-- Creator action buttons - moved below description -->
                    <div *ngIf="isCreator()" class="mt-4 mb-4">
                        <div class="d-flex flex-column flex-sm-row gap-2">
                            <button
                                type="button"
                                class="btn btn-warning text-dark btn-sm flex-grow-1"
                                (click)="editEvent()"
                                style="white-space: nowrap; padding: 0.5rem 1rem;"
                            >
                                ‚úèÔ∏è Edit Event
                            </button>
                            <button
                                type="button"
                                class="btn btn-danger btn-sm flex-grow-1"
                                (click)="deleteEvent()"
                                [disabled]="isActionLoading()"
                                style="white-space: nowrap; padding: 0.5rem 1rem;"
                            >
                                üóëÔ∏è Delete Event
                            </button>
                        </div>
                    </div>
                    <div *ngIf="!isCreator()" class="mt-4">
                        <button
                            *ngIf="!isAttending()"
                            (click)="joinEvent()"
                            [disabled]="isActionLoading() || isEventFull()"
                            class="btn btn-success btn-lg w-100"
                        >
                            <span *ngIf="!isActionLoading() && !isEventFull()">‚úÖ Attend Event</span>
                            <span *ngIf="isEventFull() && !isActionLoading()">üö´ Event Full</span>
                            <span *ngIf="isActionLoading()">
                                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                Joining...
                            </span>
                        </button>
                        <button
                            *ngIf="isAttending()"
                            (click)="leaveEvent()"
                            [disabled]="isActionLoading()"
                            class="btn btn-danger btn-lg w-100"
                        >
                            <span *ngIf="!isActionLoading()">‚ùå Leave Event</span>
                            <span *ngIf="isActionLoading()">
                                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                Leaving...
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Participants Section -->
        <div class="col-12 col-lg-4">
            <app-participant-list [participants]="participants()"></app-participant-list>
                        <!-- Event chat: pass event id and creator uid -->
                        <div *ngIf="event() as evt">
                            <app-event-chat [eventId]="evt.id" [creatorUid]="evt.creatorUid"></app-event-chat>
                        </div>
        </div>
    </div>
</div>
